{% extends "::vueMere.html.twig" %}



{% block contenuCentral %}

<script src="../../vendor/tableExport/tableExport.js"></script>
<script src="../../vendor/tableExport/jquery.base64.js"></script>
<script src="../../vendor/tableExport/html2canvas.js"></script>
<script src="../../vendor/tableExport/jspdf/libs/sprintf.js"></script>
<script src="../../vendor/tableExport/jspdf/jspdf.js"></script>
<script src="../../vendor/tableExport/jspdf/libs/base64.js"></script>

<script src="http://code.jquery.com/jquery-latest.js"></script>

<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.2.0/jquery.min.js"></script>

{# Contient la liste des stages ... #}
<div style="margin-top:18px;"> <!-- pour descendre le contenu de x pixels -->

<div class="panel panel-default filterable ">
    <div class="panel-heading">
        <h3> Liste des Stages </h3> 
        <!-- bouton de filtrage qui affiche toutes les promotions existantes -->
        <div class="row">
            <div class="col-lg-2 col-lg-offset-8">
                <button class="btn btn-primary btn-filter" style="width:140px" type="button">Recherche</button>
            </div>
            <div class="col-lg-2 ">
                <div class="btn-group ">
                    <button type="button" class="btn btn-primary dropdown-toggle dropdown" style="width:140px" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" >
                    Filtrer <span class="caret"></span>
                    </button>
                    <ul class="dropdown-menu pull-right" style="width:200px" >
                        <li><a href="{{ path('btsappli_utilisateurs_suiviStages') }}"> Tous </a></li>
                        <li role="separator" class="divider"></li>
                        <li><a href="{{ path('btsappli_utilisateurs_suiviStagesFiltrerPasStage') }}"> Pas de stage </a></li>
                        <li role="separator" class="divider"></li>
                        <li><a href="{{ path('btsappli_utilisateurs_suiviStagesFiltrerConventionNonValidee') }}"> Convention non validée </a></li>
                        <li><a href="{{ path('btsappli_utilisateurs_suiviStagesFiltrerConventionValidee') }}"> Convention validée </a></li>
                        <li><a href="{{ path('btsappli_utilisateurs_suiviStagesFiltrerConventionSignee') }}"> Convention signée </a></li>
                        <li role="separator" class="divider"></li>
                        {% for promotionCourante in tabPromotions %}
                            <li><a href="{{ path('btsappli_utilisateurs_suiviStagesFiltrerPromo', {'idPromo':promotionCourante.id}) }}">Promotion {{ promotionCourante.anneePromo }} </a></li>
                        {% endfor %}
                    </ul>
                </div>
            </div>
        </div>
    </div>
    <!-- Création du tableau contenant la liste des stages -->
    <div class="table-responsive">
        <table id="customers" class="table table-striped table-hover">
                <!-- Création de la première ligne contenant le nom de chaque colonne principale -->
            <thead>
                <tr align="center">
                    <td class="warning"></td> 
                    <td class="warning">Etudiants</td> 
                    <td class="warning"></td>
                    
                    <td class="success"></td>
                    <td class="success"></td>
                    <td class="success"></td>
                    <td class="success">Entreprises</td>
                    <td class="success"></td>
                    <td class="success"></td>
                    <td class="success"></td>
                    
                    <td class="danger"></td>
                </tr>
                <!-- Création de la première ligne contenant le nom de chaque colonne secondaire avec filtrage -->
                <tr class="filters info" >
                        <th><input type="text" class="form-control" placeholder="Nom" disabled></th>
                        <th><input type="text" class="form-control" placeholder="Prénom" disabled></th>
                        <th><input type="text" class="form-control" placeholder="Statut" disabled></th>

                        <th><input type="text" class="form-control" placeholder="Nom" disabled></th>
                        <th><input type="text" class="form-control" placeholder="Adresse" disabled></th>
                        <th><input type="text" class="form-control" placeholder="CP" disabled></th>
                        <th><input type="text" class="form-control" placeholder="Ville" disabled></th>
                        <th><input type="text" class="form-control" placeholder="Pays" disabled></th>
                        <th><input type="text" class="form-control" placeholder="E-Mail" disabled></th>
                        <th><input type="text" class="form-control" placeholder="Tél" disabled></th>
                        
                        <td><b>Suppr. stage</b></td>
                </tr>
            </thead>
            <tbody>
            <!-- Affichage de tous les stages -->
            {% for userCourant in tabUsersEtStages %}  
                {% if userCourant.stage == null %}
                <tr align="center">
                {% else %}
                <tr align="center" onclick="document.location.href='{{ path('btsappli_utilisateurs_voirStageEtu', {'id':userCourant.id}) }}'" style="cursor:pointer">
                {% endif %}
                    <td>{{userCourant.nom}}</td>
                    <td>{{userCourant.prenom}}</td>
                
                {% if userCourant.stage is not null %}
                {% if userCourant.stage.etatConvention == 1 %}
                    <td> Non Validée</td>
                {% endif %}
                {% if userCourant.stage.etatConvention == 2 %}
                    <td> Validée </td>
                {% endif %}
                {% if userCourant.stage.etatConvention == 3 %}
                    <td> Signée </td>
                {% endif %}
                {% if userCourant.stage.etatConvention == null %}
                    <td></td>
                {% endif %}

                
                    
                    <td>{{userCourant.stage.entreprise.nom}}</td>
                    <td>{{userCourant.stage.entreprise.adresse}}</td>
                    <td>{{userCourant.stage.entreprise.codePostal}}</td>
                    <td>{{userCourant.stage.entreprise.ville}}</td>
                    <td>{{userCourant.stage.entreprise.pays}}</td>
                    <td>{{userCourant.stage.entreprise.adresseMail}}</td>
                    <td>0{{userCourant.stage.entreprise.telephone}}</td> 
                    
                    <td>
                        <a type="button" class="btn btn-danger"  href="{{ path('btsappli_utilisateurs_supprimerStageValidation', {'id':userCourant.id}) }}"><span class="glyphicon glyphicon-remove" aria-hidden="true" ></span></a>
                    </td>
                    
                {% else %}
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    
                    
                {% endif %}

                </tr>
           {% endfor %}
           </tbody>
        </table>
    </div>
</div>
</div>

<div class="row">
        <div class="col-lg-1 ">
            <a href="{{ path('btsappli_utilisateurs_accueilAdmin') }}" role="button" class="btn btn-primary" type="button" style="width:140px">Retour</a>
        </div>
    
        <!--<div class="col-lg-1  col-lg-offset-2">
            <a href="#" role="button" onclick="javascript:window.print()" class="btn btn-primary" type="button" style="width:140px">Imprimer</a>
        </div> -->
        
        <div class="col-lg-1  col-lg-offset-7">
            <a href="{{ path('btsappli_utilisateurs_ReinitStagesValidation') }}" role="button" class="btn btn-info" type="button" style="width:140px"><span class="glyphicon glyphicon-repeat" aria-hidden="true"></span>&nbsp;&nbsp;Réinitialiser</a>
        </div>
        
        <div class="col-lg-1 col-lg-offset-2">
            <a href="#" role="button" onClick ="$('#customers').tableExport({type:'png',escape:'false'});" class="btn btn-info pull-right" type="button" style="width:140px"><span class="glyphicon glyphicon-print" aria-hidden="true"></span>&nbsp;&nbsp;Imprimer</a>
        </div>
</div>


<script>
    $(document).ready(function(){
    $('.filterable .btn-filter').click(function(){
        var $panel = $(this).parents('.filterable'),
        $filters = $panel.find('.filters input'),
        $tbody = $panel.find('.table tbody');
        if ($filters.prop('disabled') == true) {
            $filters.prop('disabled', false);
            $filters.first().focus();
        } else {
            $filters.val('').prop('disabled', true);
            $tbody.find('.no-result').remove();
            $tbody.find('tr').show();
        }
    });

    $('.filterable .filters input').keyup(function(e){
        /* Ignore tab key */
        var code = e.keyCode || e.which;
        if (code == '9') return;
        /* Useful DOM data and selectors */
        if(!$table) $table = $panel;
        var $input = $(this),
        inputContent = $input.val().toLowerCase(),
        $panel = $input.parents('.filterable'),
        column = $panel.find('.filters th').index($input.parents('th')),
        $table = $panel.find('.table'),
        $rows = $table.find('tbody tr');
        /* Dirtiest filter function ever ;) */
        var $filteredRows = $rows.filter(function(){
            var value = $(this).find('td').eq(column).text().toLowerCase();
            return value.indexOf(inputContent) === -1;
        });
        /* Clean previous no-result if exist */
        $table.find('tbody .no-result').remove();
        /* Show all rows, hide filtered ones (never do that outside of a demo ! xD) */
        $rows.show();
        $filteredRows.hide();
        /* Prepend no-result row if all rows are filtered */
        if ($filteredRows.length === $rows.length) {
            $table.find('tbody').prepend($('<tr class="no-result text-center"><td colspan="'+ $table.find('.filters th').length +'">Aucune correspondance</td></tr>'));
        }
    });
});
</script>

<script>
    (function($){
        $.fn.extend({
            tableExport: function(options) {
                var defaults = {
						separator: ',',
						ignoreColumn: [],
						tableName:'yourTableName',
						type:'csv',
						pdfFontSize:14,
						pdfLeftMargin:20,
						escape:'true',
						htmlContent:'false',
						consoleLog:'false'
				};
                
				var options = $.extend(defaults, options);
				var el = this;
				
				if(defaults.type == 'csv' || defaults.type == 'txt'){
				
					// Header
					var tdData ="";
					$(el).find('thead').find('tr').each(function() {
					tdData += "\n";					
						$(this).filter(':visible').find('th').each(function(index,data) {
							if ($(this).css('display') != 'none'){
								if(defaults.ignoreColumn.indexOf(index) == -1){
									tdData += '"' + parseString($(this)) + '"' + defaults.separator;									
								}
							}
							
						});
						tdData = $.trim(tdData);
						tdData = $.trim(tdData).substring(0, tdData.length -1);
					});
					
					// Row vs Column
					$(el).find('tbody').find('tr').each(function() {
					tdData += "\n";
						$(this).filter(':visible').find('td').each(function(index,data) {
							if ($(this).css('display') != 'none'){
								if(defaults.ignoreColumn.indexOf(index) == -1){
									tdData += '"'+ parseString($(this)) + '"'+ defaults.separator;
								}
							}
						});
						//tdData = $.trim(tdData);
						tdData = $.trim(tdData).substring(0, tdData.length -1);
					});
					
					//output
					if(defaults.consoleLog == 'true'){
						console.log(tdData);
					}
					var base64data = "base64," + $.base64.encode(tdData);
					window.open('data:application/'+defaults.type+';filename=exportData;' + base64data);
				}else if(defaults.type == 'sql'){
				
					// Header
					var tdData ="INSERT INTO `"+defaults.tableName+"` (";
					$(el).find('thead').find('tr').each(function() {
					
						$(this).filter(':visible').find('th').each(function(index,data) {
							if ($(this).css('display') != 'none'){
								if(defaults.ignoreColumn.indexOf(index) == -1){
									tdData += '`' + parseString($(this)) + '`,' ;									
								}
							}
							
						});
						tdData = $.trim(tdData);
						tdData = $.trim(tdData).substring(0, tdData.length -1);
					});
					tdData += ") VALUES ";
					// Row vs Column
					$(el).find('tbody').find('tr').each(function() {
					tdData += "(";
						$(this).filter(':visible').find('td').each(function(index,data) {
							if ($(this).css('display') != 'none'){
								if(defaults.ignoreColumn.indexOf(index) == -1){
									tdData += '"'+ parseString($(this)) + '",';
								}
							}
						});
						
						tdData = $.trim(tdData).substring(0, tdData.length -1);
						tdData += "),";
					});
					tdData = $.trim(tdData).substring(0, tdData.length -1);
					tdData += ";";
					
					//output
					//console.log(tdData);
					
					if(defaults.consoleLog == 'true'){
						console.log(tdData);
					}
					
					var base64data = "base64," + $.base64.encode(tdData);
					window.open('data:application/sql;filename=exportData;' + base64data);
					
				
				}else if(defaults.type == 'json'){
				
					var jsonHeaderArray = [];
					$(el).find('thead').find('tr').each(function() {
						var tdData ="";	
						var jsonArrayTd = [];
					
						$(this).filter(':visible').find('th').each(function(index,data) {
							if ($(this).css('display') != 'none'){
								if(defaults.ignoreColumn.indexOf(index) == -1){
									jsonArrayTd.push(parseString($(this)));									
								}
							}
						});									
						jsonHeaderArray.push(jsonArrayTd);						
						
					});
					
					var jsonArray = [];
					$(el).find('tbody').find('tr').each(function() {
						var tdData ="";	
						var jsonArrayTd = [];
					
						$(this).filter(':visible').find('td').each(function(index,data) {
							if ($(this).css('display') != 'none'){
								if(defaults.ignoreColumn.indexOf(index) == -1){
									jsonArrayTd.push(parseString($(this)));									
								}
							}
						});									
						jsonArray.push(jsonArrayTd);									
						
					});
					
					var jsonExportArray =[];
					jsonExportArray.push({header:jsonHeaderArray,data:jsonArray});
					
					//Return as JSON
					//console.log(JSON.stringify(jsonExportArray));
					
					//Return as Array
					//console.log(jsonExportArray);
					if(defaults.consoleLog == 'true'){
						console.log(JSON.stringify(jsonExportArray));
					}
					var base64data = "base64," + $.base64.encode(JSON.stringify(jsonExportArray));
					window.open('data:application/json;filename=exportData;' + base64data);
				}else if(defaults.type == 'xml'){
				
					var xml = '<?xml version="1.0" encoding="utf-8"?>';
					xml += '<tabledata><fields>';

					// Header
					$(el).find('thead').find('tr').each(function() {
						$(this).filter(':visible').find('th').each(function(index,data) {
							if ($(this).css('display') != 'none'){					
								if(defaults.ignoreColumn.indexOf(index) == -1){
									xml += "<field>" + parseString($(this)) + "</field>";
								}
							}
						});									
					});					
					xml += '</fields><data>';
					
					// Row Vs Column
					var rowCount=1;
					$(el).find('tbody').find('tr').each(function() {
						xml += '<row id="'+rowCount+'">';
						var colCount=0;
						$(this).filter(':visible').find('td').each(function(index,data) {
							if ($(this).css('display') != 'none'){	
								if(defaults.ignoreColumn.indexOf(index) == -1){
									xml += "<column-"+colCount+">"+parseString($(this))+"</column-"+colCount+">";
								}
							}
							colCount++;
						});															
						rowCount++;
						xml += '</row>';
					});					
					xml += '</data></tabledata>'
					
					if(defaults.consoleLog == 'true'){
						console.log(xml);
					}
					
					var base64data = "base64," + $.base64.encode(xml);
					window.open('data:application/xml;filename=exportData;' + base64data);

				}else if(defaults.type == 'excel' || defaults.type == 'doc'|| defaults.type == 'powerpoint'  ){
					//console.log($(this).html());
					var excel="<table>";
					// Header
					$(el).find('thead').find('tr').each(function() {
						excel += "<tr>";
						$(this).filter(':visible').find('th').each(function(index,data) {
							if ($(this).css('display') != 'none'){					
								if(defaults.ignoreColumn.indexOf(index) == -1){
									excel += "<td>" + parseString($(this))+ "</td>";
								}
							}
						});	
						excel += '</tr>';						
						
					});					
					
					
					// Row Vs Column
					var rowCount=1;
					$(el).find('tbody').find('tr').each(function() {
						excel += "<tr>";
						var colCount=0;
						$(this).filter(':visible').find('td').each(function(index,data) {
							if ($(this).css('display') != 'none'){	
								if(defaults.ignoreColumn.indexOf(index) == -1){
									excel += "<td>"+parseString($(this))+"</td>";
								}
							}
							colCount++;
						});															
						rowCount++;
						excel += '</tr>';
					});					
					excel += '</table>'
					
					if(defaults.consoleLog == 'true'){
						console.log(excel);
					}
					
					var excelFile = "<html xmlns:o='urn:schemas-microsoft-com:office:office' xmlns:x='urn:schemas-microsoft-com:office:"+defaults.type+"' xmlns='http://www.w3.org/TR/REC-html40'>";
					excelFile += "<head>";
					excelFile += "<!--[if gte mso 9]>";
					excelFile += "<xml>";
					excelFile += "<x:ExcelWorkbook>";
					excelFile += "<x:ExcelWorksheets>";
					excelFile += "<x:ExcelWorksheet>";
					excelFile += "<x:Name>";
					excelFile += "{worksheet}";
					excelFile += "</x:Name>";
					excelFile += "<x:WorksheetOptions>";
					excelFile += "<x:DisplayGridlines/>";
					excelFile += "</x:WorksheetOptions>";
					excelFile += "</x:ExcelWorksheet>";
					excelFile += "</x:ExcelWorksheets>";
					excelFile += "</x:ExcelWorkbook>";
					excelFile += "</xml>";
					excelFile += "<![endif]-->";
					excelFile += "</head>";
					excelFile += "<body>";
					excelFile += excel;
					excelFile += "</body>";
					excelFile += "</html>";

					var base64data = "base64," + $.base64.encode(excelFile);
					window.open('data:application/vnd.ms-'+defaults.type+';filename=exportData.doc;' + base64data);
					
				}else if(defaults.type == 'png'){
					html2canvas($(el), {
						onrendered: function(canvas) {										
							var img = canvas.toDataURL("image/png");
							window.open(img);
							
							
						}
					});		
				}else if(defaults.type == 'pdf'){
	
					var doc = new jsPDF('p','pt', 'a4', true);
					doc.setFontSize(defaults.pdfFontSize);
					
					// Header
					var startColPosition=defaults.pdfLeftMargin;
					$(el).find('thead').find('tr').each(function() {
						$(this).filter(':visible').find('th').each(function(index,data) {
							if ($(this).css('display') != 'none'){					
								if(defaults.ignoreColumn.indexOf(index) == -1){
									var colPosition = startColPosition+ (index * 50);									
									doc.text(colPosition,20, parseString($(this)));
								}
							}
						});									
					});					
				
				
					// Row Vs Column
					var startRowPosition = 20; var page =1;var rowPosition=0;
					$(el).find('tbody').find('tr').each(function(index,data) {
						rowCalc = index+1;
						
					if (rowCalc % 26 == 0){
						doc.addPage();
						page++;
						startRowPosition=startRowPosition+10;
					}
					rowPosition=(startRowPosition + (rowCalc * 10)) - ((page -1) * 280);
						
						$(this).filter(':visible').find('td').each(function(index,data) {
							if ($(this).css('display') != 'none'){	
								if(defaults.ignoreColumn.indexOf(index) == -1){
									var colPosition = startColPosition+ (index * 50);									
									doc.text(colPosition,rowPosition, parseString($(this)));
								}
							}
							
						});															
						
					});					
										
					// Output as Data URI
					doc.output('datauri');
	
				}
				
				
				function parseString(data){
				
					if(defaults.htmlContent == 'true'){
						content_data = data.html().trim();
					}else{
						content_data = data.text().trim();
					}
					
					if(defaults.escape == 'true'){
						content_data = escape(content_data);
					}
					
					
					
					return content_data;
				}
			
			}
        });
    })(jQuery);
</script>
{% endblock %}





